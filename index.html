<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>IoT Panel - Login & Register</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #4a00e0, #8e2de2);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
    }
    .card {
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .hidden {
      display: none;
    }
    .iot-btn {
      width: 100px;
      height: 100px;
      margin: 10px;
      border-radius: 20px;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGIN -->
    <div id="loginPage" class="card p-4 text-dark">
      <h2 class="text-center mb-3">Login IoT</h2>
      <input type="email" id="loginEmail" class="form-control mb-3" placeholder="Email">
      <input type="password" id="loginPassword" class="form-control mb-3" placeholder="Password">
      <button class="btn btn-primary w-100" onclick="login()">Login</button>
      <p class="mt-3 text-center">Belum punya akun? <a href="#" onclick="showRegister()">Register</a></p>
    </div>

    <!-- REGISTER -->
    <div id="registerPage" class="card p-4 text-dark hidden">
      <h2 class="text-center mb-3">Register Akun</h2>
      <input type="text" id="regName" class="form-control mb-3" placeholder="Nama Lengkap">
      <input type="email" id="regEmail" class="form-control mb-3" placeholder="Email">
      <input type="password" id="regPassword" class="form-control mb-3" placeholder="Password">
      <button class="btn btn-success w-100" onclick="register()">Daftar</button>
      <p class="mt-3 text-center">Sudah punya akun? <a href="#" onclick="showLogin()">Login</a></p>
    </div>

    <!-- PANEL -->
    <div id="panelPage" class="card p-4 text-dark hidden">
      <h2 class="text-center mb-3">IoT Control Panel</h2>
      <p class="text-center">Halo, <span id="userName"></span>!</p>
      <div class="d-flex justify-content-center flex-wrap">
        <button class="btn btn-outline-primary iot-btn" onclick="sendCommand('LED1')">LED 1</button>
        <button class="btn btn-outline-success iot-btn" onclick="sendCommand('LED2')">LED 2</button>
        <button class="btn btn-outline-warning iot-btn" onclick="sendCommand('FAN')">FAN</button>
        <button class="btn btn-outline-danger iot-btn" onclick="sendCommand('BUZZER')">Buzzer</button>
      </div>
      <button class="btn btn-secondary mt-4 w-100" onclick="logout()">Logout</button>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script>
    // Ganti dengan config Firebase kamu
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT.firebaseapp.com",
      databaseURL: "https://esp8266-8353a-default-rtdb.firebaseio.com/",
      projectId: "YOUR-PROJECT-ID",
      storageBucket: "YOUR-PROJECT.appspot.com",
      messagingSenderId: "SENDER-ID",
      appId: "APP-ID"
    };
    firebase.initializeApp(firebaseConfig);

    const db = firebase.database();
    const auth = firebase.auth();

    // Login
    function login() {
      const email = document.getElementById('loginEmail').value;
      const pass = document.getElementById('loginPassword').value;
      auth.signInWithEmailAndPassword(email, pass)
        .then(user => {
          document.getElementById("loginPage").classList.add("hidden");
          document.getElementById("panelPage").classList.remove("hidden");
          document.getElementById("userName").innerText = email;
        })
        .catch(err => alert(err.message));
    }

    // Register
    function register() {
      const name = document.getElementById('regName').value;
      const email = document.getElementById('regEmail').value;
      const pass = document.getElementById('regPassword').value;
      auth.createUserWithEmailAndPassword(email, pass)
        .then(user => {
          db.ref("users/" + user.user.uid).set({ name, email });
          alert("Pendaftaran berhasil!");
          showLogin();
        })
        .catch(err => alert(err.message));
    }

    // Logout
    function logout() {
      auth.signOut().then(() => {
        document.getElementById("panelPage").classList.add("hidden");
        document.getElementById("loginPage").classList.remove("hidden");
      });
    }

    // Kirim perintah IoT
    function sendCommand(cmd) {
      db.ref("commands").push({
        device: cmd,
        time: new Date().toISOString()
      });
      alert("Command " + cmd + " terkirim!");
    }

    // Ganti halaman
    function showRegister() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("registerPage").classList.remove("hidden");
    }
    function showLogin() {
      document.getElementById("registerPage").classList.add("hidden");
      document.getElementById("loginPage").classList.remove("hidden");
    }
  </script>
</body>
</html>
